<!DOCTYPE html>
<html lang="en">

<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <UTF-8>

        <title>Registrarse</title>
        <link rel="stylesheet" href="../css/font.css">
        <script src="../js/jquery-3.6.0.min.js" type="text/javascript"></script>
        <script src="../js/saludsecure.js" type="text/javascript"></script>
        <script src="../js/metaMask.js" type="text/javascript"></script>
        <script src="../js/saludSecureABI.js" type="text/javascript"></script>
        <script src="../js/saludsecure.js" type="text/javascript"></script>
        <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
        <script language="javascript" type="text/javascript" 
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script language="javascript" type="text/javascript" 
        src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script>

        <link rel="stylesheet" href="../css/Sesiones.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="Icon" href="../imagenes/logo-Header.png">
</head>


<body class="Rbody">
    <input type="button" id="backgroundimgReg"value="">
    <div id="transition"> 
    <label id="textlos">Los </label> <label id="medicostxt">médicos</label> <label id="textpueden"> pueden:</label>
    </div>
   
    <br><br><br>
    <label id="lbl1">- Agregar pacientes de forma rápida</label>
    <br><br><br>
    <label id="lbl2">- Crear recetas para cada paciente</label>
    <br><br><br>
    <label id="lbl3">- Visualizar las recetas creadas</label>
    



    <div id="registerformM">
      <h1 id="regh1">Registrarse</h1>
      <br>
        <input class= "ingresarR" name="SignInNombrem" id="NomMed" placeholder="Nombre" />
        <br><br>
        <input class= "ingresarR" name= "Aream" id="AreaMed" placeholder="Area medica" />
        <br><br>
        <input class= "ingresarR" name= "SignInUsum" id="UsuMed"placeholder="Ingresar DNI" />
        <br><br>
        <input class= "ingresarR" name="SingInContram" id="PassMed" type= "password"  placeholder="Crea una contrasenia" />
        <br><br>
        <input class= "ingresarR" name="SingInApellm" id="ApeMed" placeholder="Apellido" />
        <br><br>
        <input class= "ingresarR" name= "Telefonom" id="teleMed" placeholder="Telefono" />
        <br><br> 
        <div id="divr">
        </div>
        <input id="RegistrarMed" type= "submit" class="minibutton" name= "Registrarse" value="Crear cuenta"/>
        <br><br>    
        <label id="yatienescuenta"  >ya tienes cuenta? </label>
        <a href="../html/Iniciarsesion_med.html" class="linkIS">Inicia Sesion</a>
        <br>
       
    </div>
    <div id="msgDoc">
    </div>
    <div id="divAgregardatosM">
    </div>
    <script>
        var web3 = new Web3(window.ethereum);
        var contract = new web3.eth.Contract(contract_abi, "0x633284cb7e86cf89C42297FA5b533e9aB1F0dA18");
        async () => {
            web3 = await ethereum.request({ method: 'eth_requestAccounts'});
        }
        async function connectWallet() {
            userAccount = web3.currentProvider.selectedAddress
            console.log(userAccount)     
        }
        function setearMedico() {
            console.log("set")
            $("#txStatus").text("Asignando medico. Puede tardar un rato...");
            var nombrePaciente;
            var especializacion;
            nombreApellido = (document.getElementById('NomMed').value) + (" ") +(document.getElementById('ApeMed').value);
            especializacion = document.getElementById('AreaMed').value;
            var txn = contract.methods.set_Medico(nombreApellido, especializacion)
                txn = txn.send({from:web3.eth.currentProvider.selectedAddress});

        }
            async function conexionWeb3(){
            //import detectEthereumProvider from '@metamask/detect-provider';
                if (typeof window.etherseum !== "undefined" || window.ethereum._state.account == undefined) {   
                    const accounts = await ethereum.request({ method: 'eth_requestAccounts'});
                    // mirarRecetas();
                    if(accounts.length !== null){
                    await connectWallet();
                    await setearMedico();
                    // await sendReceta();
                        //DIV QUE DIGA METAMASK CONECTADO!
                    }                                      
                }
                else{
                    alert("No tiene instalado MetaMask, por favor instalelo");  
                    await window.open("https://metamask.io/download/", "_blank");
                }
            }
            var button = document.getElementById("RegistrarMed")
            button.addEventListener("click",  conexionWeb3)  
        </script>
</body>
</html>